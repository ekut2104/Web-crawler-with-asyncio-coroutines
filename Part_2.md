# Веб бот, использующий сопрограммы asyncio (2 часть)

Это продолжение статьи. Начало смотрите [здесь](https://github.com/igorzakhar/Web-crawler-with-asyncio-coroutines/blob/master/Part_1.md)

Прежде, чем разбираться с генераторами языка Python, вы должны понимать, как в нем работают обычные функции. Обычно, когда функция на языке Python вызывает подпрограмму, подпрограмма осуществляет управление до тех пор, пока не произойдет явный возврат управления или пока не возникнет исключение. Затем управление возвращается туда, откуда произошел вызов:  

```python
>>> def foo():
...     bar()
...
>>> def bar():
...     pass
```

Стандартный интерпретатор языка Python написан на С. Функция С, с помощью которой исполняется функция Python, называется ```PyEval_EvalFrameEx```. Она берет объект, представляющий собой некоторый фрагмент стека языка Python, и выполняет интерпретацию байт-кода Python в контексте взятого фрагмента. Ниже приведен байт-код для функции ```foo```:
```python
>>> import dis
>>> dis.dis(foo)
  2           0 LOAD_GLOBAL              0 (bar)
              3 CALL_FUNCTION            0 (0 positional, 0 keyword pair)
              6 POP_TOP
              7 LOAD_CONST               0 (None)
             10 RETURN_VALUE
```

Функция foo загружает функцию ```bar``` в этот стек и вызывает ее, а затем выталкивает из стека возвращаемое значение, загружает ```None``` в стек и возвращает ```None```.  

Когда функция ```PyEval_EvalFrameEx``` встретит байт-код ```CALL_FUNCTION```, она создает новый фрагмент стека Python и использует рекурсию: то есть, она рекурсивно вызывает ```PyEval_EvalFrameEx``` с новым фрагментом стека, который используется для выполнения функции ```bar```.  
![PyEval_EvalFrameEx](https://github.com/igorzakhar/Web-crawler-with-asyncio-coroutines/blob/master/images/aosa0301.png)